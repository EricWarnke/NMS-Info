<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Generator</title>
    <script type="text/javascript">
    function generateJson() {
      var obj = {};

      obj.title = document.querySelector('.title').value;

      var arr = document.querySelectorAll('.text input');
      for (var i = 0; i < arr.length; i++) {
        if (!obj.text)
          obj.text = [];
        obj.text[i] = arr[i].value;
      }

      arr = document.querySelectorAll('.sources input');
      for (var i = 0; i < arr.length; i++) {
        if (!obj.sources)
          obj.sources = [];
        obj.sources[i] = arr[i].value;
      }

      arr = document.querySelectorAll('.categories input');
      for (var i = 0; i < arr.length; i++) {
        if (!obj.categories)
          obj.categories = [];
        obj.categories[i] = arr[i].value;
      }

      arr = document.querySelectorAll('.related input');
      for (var i = 0; i < arr.length; i++) {
        if (!obj.related)
          obj.related = [];
        obj.related[i] = arr[i].value;
      }

      arr = document.querySelectorAll('.keywords input');
      for (var i = 0; i < arr.length; i++) {
        if (!obj.keywords)
          obj.keywords = [];
        obj.keywords[i] = arr[i].value;
      }

      if (document.querySelector('.spoiler').checked)
        obj.spoiler = true;

      document.querySelector('.output').value = JSON.stringify(obj);
    }
    function parseJson() {
      var arr = document.querySelectorAll('.inputContainer');
      for (var i = 0; i < arr.length; i++){
        arr[i].innerHTML = '';
        addAddButton(arr[i]);
      }

      var obj = JSON.parse(document.querySelector('.output').value);

      if (obj.title) {
        document.querySelector('.title').value = obj.title;
      }
      if (obj.text) {
        obj.text.forEach(function(item){
          addInput(document.querySelector('.text')).querySelector('input').value = item;
        });
      }
      if (obj.sources) {
        obj.sources.forEach(function(item){
          addInput(document.querySelector('.sources')).querySelector('input').value = item;
        });
      }
      if (obj.categories) {
        obj.categories.forEach(function(item){
          addInput(document.querySelector('.categories')).querySelector('input').value = item;
        });
      }
      if (obj.related) {
        obj.related.forEach(function(item){
          addInput(document.querySelector('.related')).querySelector('input').value = item;
        });
      }
      if (obj.keywords) {
        obj.keywords.forEach(function(item){
          addInput(document.querySelector('.keywords')).querySelector('input').value = item;
        });
      }
      if (obj.spoiler) {
        document.querySelector('.spoiler').checked = true;
      }
    }
    function addInput(parent){
      'use strict';
      var newEl = document.createElement('p');
      newEl.classList.add('input');
      newEl.innerHTML = '<input type="text"'+ (parent.classList.contains('categories') ? ' list="categories" ': '') +'>';
      addRemoveButton(newEl);
      parent.appendChild(newEl);
      return newEl;
    }
    function addAddButton(parent){
      var button = document.createElement('button')
      button.type = 'button';
      button.innerHTML = 'add';
      button.classList.add('add');
      button.addEventListener('click', function(){addInput(this.parentNode);});
      parent.appendChild(button);
      return button;
    }
    function addRemoveButton(parent){
      var button = document.createElement('button')
      button.type = 'button';
      button.innerHTML = 'remove';
      button.classList.add('remove');
      button.addEventListener('click', function(){this.parentNode.parentNode.removeChild(this.parentNode);});
      parent.appendChild(button);
      return button;
    }
    window.addEventListener('DOMContentLoaded', function(){
      'use strict';
      var arr = document.querySelectorAll('.inputContainer');
      for (var i = 0; i < arr.length; i++)
        addAddButton(arr[i]);
      document.querySelector('button.generate').addEventListener('click', generateJson);
      document.querySelector('button.parse').addEventListener('click', parseJson);
    });
    </script>
  </head>
  <body>
    <datalist id="categories">
      <option value="No Man's Sky Universe">
      <option value="Star Systems">
      <option value="Planets">
      <option value="Other Bodies">
      <option value="Game Mechanics">
      <option value="The Atlas">
      <option value="Meta">
      <option value="Crafting">
      <option value="News">
      <option value="Economy">
      <option value="Life">
      <option value="Miscellaneous">
    </datalist>
    <p>
      This is a page to help with formatting the json <br>
      It's here purely for convenience
    </p>
    <input type="text" name="" placeholder="title" class="title">
    <p>
      text
    </p>
    <div class="inputContainer text">

    </div>
    <p>
      sources
    </p>
    <div class="inputContainer sources">

    </div>
    <p>
      categories
    </p>
    <div class="inputContainer categories">

    </div>
    <p>
      related - use title of card
    </p>
    <div class="inputContainer related">

    </div>
    <p>
      keywords
    </p>
    <div class="inputContainer keywords">

    </div>
    <p>
      <input type="checkbox" class="spoiler"> spoiler
    </p>
    <button type="button" name="generate" class="generate">generate</button>
    <button type="button" name="parse" class="parse">parse</button>
    <p>
      output:
    </p>
    <textarea name="name" rows="8" cols="40" class="output"></textarea>
  </body>
</html>
